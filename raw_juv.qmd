# Juveniles  

## Datasets  

There are two datasets that represent juveniles: SCDNR's Creek Trawls, and NIW NERR's Oyster Landing seines. We will explore each.  

```{r}
library(tidyverse)
library(patchwork)
library(readxl)
library(ggbeeswarm)

source("functions.R")

in_path <- here::here("data", "raw", "juv")

surv_sc <- "SCDNR Creek Trawls"
surv_ol <- "Oyster Landing Seines"
```

```{r}
juv_sc_cpue <- read.csv(here::here(in_path, "SCDNR_CreekTrawlShrimpCPUE.csv"))
juv_sc_size <- read.csv(here::here(in_path, "SCDNR_CreekTrawlShrimpSize.csv"))

juv_ol <- read.csv(here::here(in_path, 
                              "Oyster Landing Seine Shrimp Dataset - 1984-2023 (BWP, 2025-04-24)(kac 2025-06-02).csv"))
```

Pull out date characteristics and deal with column types if necessary; change Species columns to common names.    

(OL's temp and salinity columns are character, due to entries of "DataGap". Weight has an entry that is only a decimal point. I'll turn these to NAs manually before forcing to numeric so that if anything else is odd (e.g. two decimal points in a number) I'll get a warning about the coercion and can look into it.)

```{r}
juv_sc_size <- juv_sc_size |> 
    mutate(Date = lubridate::mdy(DTStart),
           Year = lubridate::year(Date),
           Month = lubridate::month(Date),
           Species = case_when(Species == "Penaeus aztecus" ~ "brown",
                               Species == "Penaeus setiferus" ~ "white",
                               Species == "Penaeus duorarum" ~ "pink",
                               .default = "uh-oh"))

juv_sc_cpue <- juv_sc_cpue |> 
    mutate(Species = case_when(Species == "Penaeus aztecus" ~ "brown",
                               Species == "Penaeus setiferus" ~ "white",
                               Species == "Penaeus duorarum" ~ "pink",
                               .default = "uh-oh"))

juv_ol <- juv_ol |> 
    mutate(Date = lubridate::mdy(Date),
           Month = lubridate::month(Date),
           Temp = case_when(Temp == "DataGap" ~ NA_character_,
                            Temp == "" ~ NA_character_,
                            .default = Temp),
           Sal = case_when(Sal == "DataGap" ~ NA_character_,
                           Sal == "" ~ NA_character_,
                           .default = Sal),
           Weight = case_when(Weight == "." ~ NA_character_,
                              .default = Weight),
           Temp = as.numeric(Temp),
           Sal = as.numeric(Sal),
           Weight = as.numeric(Weight),
           Species = case_when(Species == "Farfantepenaeus aztecus" ~ "brown",
                               Species == "Litopenaeus setiferus" ~ "white",
                               .default = "uh-oh"))
```



Count and size are in the same file for Oyster Landing - up to 100 lengths taken, in columns. Probably should split this and pivot the lengths to long.  

```{r}
juv_ol_count <- juv_ol |> 
    select(Sample:Count)

juv_ol_size <- juv_ol |> 
    select(Sample:Species,
           starts_with("LEN")) |> 
    pivot_longer(cols = starts_with("LEN"),
                 names_to = "Rep",
                 values_to = "Length") |> 
    filter(!is.na(Length))
```

```{r}
# save to use later
save(juv_sc_cpue, juv_sc_size,
     juv_ol_count, juv_ol_size,
     file = here::here("data",
                       "intermediate",
                       "juvenile_dfs.RData"),
     compress = "xz")
```


## Tabular summaries of abundance  

#### SCDNR Creek Trawls  

```{r}
#| label: tbl-abundance-sc
#| tbl-cap: "Abundance (SC) data frame summary"
skimr::skim_without_charts(juv_sc_cpue)
```

#### Oyster Landing Seines  

```{r}
#| label: tbl-abundance-ol
#| tbl-cap: "Abundance (Oyster Landing) data frame summary"
skimr::skim_without_charts(juv_ol_count)
```

## Tabular summaries of size   

```{r}
sz_sc_brn <- juv_sc_size |> 
    filter(Species == "brown")
sz_sc_wht <- juv_sc_size |> 
    filter(Species == "white")

sz_ol_brn <- juv_ol_size |> 
    filter(Species == "brown")
sz_ol_wht <- juv_ol_size |> 
    filter(Species == "white")
```

### Brown Shrimp  

#### SCDNR Creek Trawls  

```{r}
#| label: tbl-size-brown-sc
#| tbl-cap: "Brown shrimp (SC) size summary"
skimr::skim_without_charts(sz_sc_brn)
```

#### Oyster Landing Seines  

```{r}
#| label: tbl-size-brown-ol
#| tbl-cap: "Brown shrimp (Oyster Landing) size summary"
skimr::skim_without_charts(sz_ol_brn)
```

### White Shrimp  

#### SCDNR Creek Trawls  

```{r}
#| label: tbl-size-white-sc
#| tbl-cap: "White shrimp (SC) size summary"
skimr::skim_without_charts(sz_sc_wht)
```

#### Oyster Landing Seines  

```{r}
#| label: tbl-size-white-ol
#| tbl-cap: "White shrimp (Oyster Landing) size summary"
skimr::skim_without_charts(sz_ol_wht)
```

## Graphics - Size Distributions  

Beeswarm plots can be slow to render so I have subsetted both data frames here to 15,000 rows.  

```{r}
set.seed(1234)
# subsample OL
juv_ol_size_ind <- sample(1:nrow(juv_ol_size), size = 15000, replace = FALSE)
juv_ol_sizeb <- juv_ol_size[juv_ol_size_ind, ]
# subsample SC
juv_sc_sizeb_ind <- sample(1:nrow(juv_sc_size), size = 15000, replace = FALSE)
juv_sc_sizeb <- juv_sc_size[juv_sc_sizeb_ind, ]
```

```{r}
#| label: fig-beeswarm-sc
#| fig-cap: "Beeswarm plot of juvenile shrimp length for the SCDNR data. Points represent measurements of individual shrimp, and are colored by the month in which they were captured. The y-axis represents length. More points spread out along the x-axis for a given length means that there were more individuals of that length captured than regions where points remain closer to the center."


beeswarm_sizeDistn(juv_sc_sizeb,
                   x = "Species", y = "Length", month = "Month",
                   survey = surv_sc)
```

```{r}
#| label: fig-beeswarm-ol
#| fig-cap: "Beeswarm plot of juvenile shrimp length for the Oyster Landing seine data. Points represent measurements of individual shrimp, and are colored by the month in which they were captured. The y-axis represents length. More points spread out along the x-axis for a given length means that there were more individuals of that length captured than regions where points remain closer to the center."

beeswarm_sizeDistn(juv_ol_sizeb,
                   x = "Species", y = "Length", month = "Month",
                   survey = surv_ol)
```


There was a typo in the original files - Sample 748, from 2017-07-20, LEN21, value of 221. [confirmed from reserve that this was a typo; updated to '21' in '_corrected' file, september 2024 and then file with (kac 2025-06-02) appended to name] 

Looks like OL seines are generally catching smaller individuals of both species than the SCDNR creek trawls.  


## Graphics - Abundance/CPUE Boxplots  

```{r}
#| label: fig-abund-cpue
#| fig-cap: "Boxplots representing shrimp abundance (as either CPUE or count, depending on the survey) by month. Note the log10-scaled y-axes."

p1 <- juv_sc_cpue |> 
    mutate(TotNum = CPUE + 0.0001) |> 
    ggplot() + 
    geom_boxplot(aes(x = factor(Month),
                     y = CPUE,
                     fill = Month)) +
    facet_wrap(~Species, ncol = 1, scales = "free_y") +
    scale_y_log10() +
    khroma::scale_fill_YlOrBr() +
    labs(title = "CPUE in SCDNR Creek Trawls",
         x = "Month") +
    theme(legend.position = "none")

p2 <- juv_ol_count |> 
    mutate(Count = Count + 0.001) |> 
    ggplot() +
    geom_boxplot(aes(x = factor(Month),
                   y = Count,
                   fill = Month)) +
    scale_y_log10() +
    khroma::scale_fill_YlOrBr() +
    facet_wrap(~Species, ncol = 1, scales = "free_y") +
    labs(title = "Count in OL Seines",
         x = "Month") +
    theme(legend.position = "none")


p1 + p2

```

Both surveys (unsurprisingly) show the same temporal pattern of abundance - aztecus in May/June, with setiferus later in the year.  

